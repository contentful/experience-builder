---
import contentful from "contentful";
import { fetchBySlug } from "@contentful/experiences-sdk-react";
import { experienceConfig } from "../consts";
import ContentfulExperience from "../components/ContentfulExperience";

const client = contentful.createClient({
  space: experienceConfig.space,
  environment: experienceConfig.environment,
  host: experienceConfig.host,
  accessToken: experienceConfig.accessToken,
});

const { slug } = Astro.params;

if (!slug) return Astro.redirect("/404");

const experience = await fetchBySlug({
  client,
  slug, //could be fetched from the context
  experienceTypeId: experienceConfig.experienceTypeId,
  localeCode: experienceConfig.localeCode,
});

const experienceJSON = JSON.stringify(experience);
---

<ContentfulExperience client:load experienceJSON={experienceJSON} />
